<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BDVerse ‚Äî Lecteur de BD</title>
  <style>
    /* ---------- VARIABLES & RESET ---------- */
    :root{
      --bg: #0b0f17;
      --panel: #0f1724;
      --muted: #9aa4b2;
      --accent: #7c3aed; /* violet */
      --accent-2: #ff5c7c; /* pink */
      --card: #0b1220;
      --white: #f8fafc;
      --success: #22c55e;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #03040a 0%, #071029 100%);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.35;
      min-height:100vh;
      padding-bottom:110px; /* for bottom nav + footer */
    }

    /* ---------- NAVBAR ---------- */
    .navbar{
      position:fixed;left:0;right:0;top:0;height:64px;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 18px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      backdrop-filter: blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);z-index:1000;
    }
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;}
    .brand .logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#4c1d95);display:flex;align-items:center;justify-content:center;font-size:18px}
    .brand h1{font-size:18px}
    .nav-right{display:flex;align-items:center;gap:10px}
    .search{
      display:flex;align-items:center;gap:8px;background:var(--panel);padding:8px;border-radius:12px;width:320px;max-width:44vw;border:1px solid rgba(255,255,255,0.03);
    }
    .search input{background:transparent;border:0;outline:none;color:var(--white);width:100%}
    .btn{background:var(--accent);padding:8px 12px;border-radius:10px;border:0;color:white;font-weight:700;cursor:pointer}
    .small-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:7px 10px;border-radius:10px;color:var(--white);cursor:pointer}

    /* ---------- LAYOUT ---------- */
    main{max-width:1200px;margin:90px auto 30px;padding:0 16px}
    .hero{display:flex;align-items:center;justify-content:space-between;gap:20px;margin-bottom:18px}
    .hero-left{flex:1;min-width:220px}
    .hero h2{font-size:28px;margin-bottom:6px}
    .hero p{color:var(--muted);font-size:14px}

    /* ---------- SECTIONS & CARDS ---------- */
    .section{margin:18px 0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,0.03)}
    .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .section-title{font-weight:800}
    .see-all{color:var(--muted);font-weight:600;font-size:13px;text-decoration:none}

    .h-scroll{display:flex;gap:12px;overflow-x:auto;padding-bottom:6px}
    .h-scroll::-webkit-scrollbar{height:8px}
    .h-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:6px}

    .card{
      width:150px;flex:0 0 150px;background:linear-gradient(180deg,var(--card),rgba(0,0,0,0.15));
      border-radius:12px;overflow:hidden;cursor:pointer;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);
      transition:transform .18s, box-shadow .18s;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 14px 40px rgba(2,6,23,0.8)}
    .cover{height:200px;background:#111;display:block;position:relative}
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{padding:10px}
    .meta .title{font-weight:700;font-size:13px;color:var(--white);margin-bottom:4px}
    .meta .sub{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .badge-new{position:absolute;left:10px;top:10px;background:var(--accent-2);padding:4px 8px;border-radius:8px;font-weight:700;font-size:11px;color:white;z-index:2}

    /* ---------- FAVORIS (COEUR) ---------- */
    .favorite{
      position:absolute;right:10px;top:10px;width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.04);color:var(--white);font-weight:700;
    }
    .favorite.active{background:linear-gradient(90deg,var(--accent),#4c1d95);}

    /* ---------- MODAL DETAILS ---------- */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(2,6,23,0.7),rgba(2,6,23,0.85));z-index:2000;padding:18px
    }
    .modal.active{display:flex}
    .modal-card{width:100%;max-width:920px;background:linear-gradient(180deg,#071026,#0c1726);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);display:flex;gap:18px;align-items:flex-start}
    .modal-left{width:220px}
    .modal-left img{width:100%;border-radius:8px;display:block}
    .modal-right{flex:1}
    .modal-right h3{font-size:20px;margin-bottom:6px}
    .modal-right .meta{color:var(--muted);margin-bottom:12px}
    .synopsis{color:var(--muted);font-size:14px;margin-bottom:12px}
    .chapters{display:grid;gap:10px}
    .chapter{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .chapter:hover{background:linear-gradient(90deg, rgba(124,58,237,0.12), rgba(255,92,124,0.05))}
    .modal-actions{display:flex;gap:10px;margin-top:12px}

    /* ---------- LECTEUR ---------- */
    .reader{
      position:fixed;inset:0;background:#000;z-index:3000;display:none;flex-direction:column;
    }
    .reader.active{display:flex}
    .reader-top{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(0,0,0,0.6)}
    .reader-title{font-weight:800}
    .reader-body{flex:1;display:flex;align-items:center;justify-content:center;overflow:auto;padding:12px}
    .reader-body img{max-width:95%;max-height:95%;object-fit:contain;border-radius:6px}
    .reader-controls{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .reader-btn{background:var(--panel);color:var(--white);padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .reader-pagination{color:var(--muted)}

    /* ---------- SIMILAIRES ---------- */
    .similaires{margin-top:14px}
    .similaires h4{margin-bottom:8px}
    .similaires .h-scroll .card{width:120px;flex:0 0 120px}

    /* ---------- FOOTER & BOTTOM NAV ---------- */
    footer{
      position:fixed;left:12px;right:12px;bottom:12px;height:64px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;border:1px solid rgba(255,255,255,0.03);z-index:1000;
      backdrop-filter: blur(6px);
    }
    .footer-left{color:var(--muted);font-size:13px}
    .footer-links{display:flex;gap:12px;align-items:center}
    .footer-links a{color:var(--muted);text-decoration:none;font-weight:600;cursor:pointer}
    .bottom-nav{
      position:fixed;left:12px;right:12px;bottom:90px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(8px);
      border-radius:12px;padding:8px 12px;display:flex;justify-content:space-between;gap:6px;align-items:center;border:1px solid rgba(255,255,255,0.03);z-index:1000
    }
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--muted);font-weight:700;font-size:12px;cursor:pointer;padding:6px 12px;border-radius:8px}
    .nav-item.active{background:linear-gradient(90deg,var(--accent),#4c1d95);color:white}

    /* ---------- MODALS ABOUT / HELP / CONTACT ---------- */
    .panel-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:4000;padding:18px}
    .panel-modal .panel{width:100%;max-width:720px;background:linear-gradient(180deg,#071026,#0c1726);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);color:var(--white)}
    .panel-modal.active{display:flex}
    .panel h3{margin-bottom:8px}
    .panel p{color:var(--muted);line-height:1.5}

    /* ---------- RESPONSIVE ---------- */
    @media (max-width:900px){
      .modal-card{flex-direction:column;align-items:center}
      .modal-left{width:160px}
      .card{width:130px;flex:0 0 130px}
      .search{width:180px}
      .hero{flex-direction:column;align-items:flex-start;gap:8px}
    }
    @media (max-width:520px){
      .search{display:none}
      .card{width:120px;flex:0 0 120px}
      .brand h1{display:none}
      .navbar{padding:0 10px}
      main{margin-top:78px}
      footer{left:10px;right:10px;bottom:8px}
      .bottom-nav{bottom:80px}
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="brand">
      <div class="logo">BD</div>
      <h1>BDVerse</h1>
    </div>

    <div class="nav-right">
      <div class="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="rgba(255,255,255,0.6)" stroke-width="1.6" stroke-linecap="round"/></svg>
        <input id="searchInput" placeholder="Rechercher une BD, auteur..." />
      </div>
      <button class="small-btn" id="loginBtn">Connexion</button>
      <button class="btn" id="uploadBtn">Publier</button>
    </div>
  </nav>

  <main>
    <section class="hero">
      <div class="hero-left">
        <h2>Bienvenue sur BDVerse</h2>
        <p>Lecture fluide, recommandations et ta biblioth√®que ‚Äî design sombre, lecture confortable.</p>
      </div>
    </section>

    <!-- NOUVEAUTES -->
    <section class="section" id="section-new">
      <div class="section-header">
        <div class="section-title">üÜï Nouveaut√©s</div>
        <a class="see-all" href="#" onclick="seeAll('new')">Tout voir</a>
      </div>
      <div class="h-scroll" id="newComics"></div>
    </section>

    <!-- POPULAIRES -->
    <section class="section" id="section-popular">
      <div class="section-header">
        <div class="section-title">üî• Populaires</div>
        <a class="see-all" href="#" onclick="seeAll('popular')">Tout voir</a>
      </div>
      <div class="h-scroll" id="popularComics"></div>
    </section>

    <!-- RECOMMANDATIONS -->
    <section class="section" id="section-reco">
      <div class="section-header">
        <div class="section-title">üí´ Recommand√©s</div>
        <a class="see-all" href="#" onclick="seeAll('recommended')">Tout voir</a>
      </div>
      <div class="h-scroll" id="recommendedComics"></div>
    </section>

    <!-- FAVORIS -->
    <section class="section" id="section-favs">
      <div class="section-header">
        <div class="section-title">‚ù§Ô∏è Favoris</div>
        <a class="see-all" href="#" onclick="seeAll('favs')">Tout voir</a>
      </div>
      <div class="h-scroll" id="favoriteComics"></div>
    </section>

  </main>

  <!-- MODAL DETAILS -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true">
      <div class="modal-left">
        <img id="modalCover" src="" alt="cover" />
      </div>
      <div class="modal-right">
        <h3 id="modalTitle">Titre</h3>
        <div class="meta" id="modalMeta">Auteur ‚Ä¢ Cat√©gorie ‚Ä¢ ‚≠ê 0.0</div>
        <p class="synopsis" id="modalSynopsis">Synopsis...</p>

        <div class="modal-actions">
          <button class="btn" id="readNowBtn">Lire</button>
          <button class="small-btn" id="addFavBtn">Ajouter aux favoris</button>
        </div>

        <div class="chapters">
          <h4 style="margin-top:12px;margin-bottom:6px">Chapitres</h4>
          <div id="modalChapters"></div>
        </div>

        <div class="similaires" id="modalSimilaires">
          <h4>BD similaires</h4>
          <div class="h-scroll" id="similairesList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- LECTEUR -->
  <div class="reader" id="reader">
    <div class="reader-top">
      <div style="display:flex;align-items:center;gap:12px">
        <button class="reader-btn" onclick="closeReader()">‚Üê Retour</button>
        <div class="reader-title" id="readerTitle">Titre - Chapitre</div>
      </div>
      <div class="reader-pagination" id="readerProgress">1/1</div>
    </div>
    <div class="reader-body" id="readerBody">
      <img id="readerImg" src="" alt="page" />
    </div>
    <div class="reader-controls">
      <button class="reader-btn" id="prevBtn" onclick="prevPage()">‚Üê Pr√©c√©dent</button>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reader-btn" id="zoomOut" onclick="zoom(-0.1)">-</button>
        <button class="reader-btn" id="zoomReset" onclick="resetZoom()">Reset</button>
        <button class="reader-btn" id="zoomIn" onclick="zoom(0.1)">+</button>
      </div>
      <button class="reader-btn" id="nextBtn" onclick="nextPage()">Suivant ‚Üí</button>
    </div>
  </div>
 <!-- PANEL MODALS: ABOUT / HELP / CONTACT -->
  <div class="panel-modal" id="aboutModal">
    <div class="panel">
      <h3>√Ä propos ‚Äî BDVerse</h3>
      <p>BDVerse est une plateforme l√©g√®re pour lire et g√©rer vos bandes dessin√©es pr√©f√©r√©es. Con√ßue pour √™tre rapide, responsive et agr√©able √† utiliser sur mobile (Acode sur Android ou navigateur).</p>
      <p>Version minimale : prototype local. Pour production : h√©bergement (Netlify/Vercel), et stockage d'images sur CDN ou bucket (S3/GCS).</p>
      <div style="margin-top:12px;text-align:right"><button onclick="closePanel('aboutModal')" class="small-btn">Fermer</button></div>
    </div>
  </div>

  <div class="panel-modal" id="helpModal">
    <div class="panel">
      <h3>Aide</h3>
      <p>- Pour ajouter une BD : modifiez la variable <code>comicsData</code> dans le script et ajoutez vos images (ou URL).<br>
         - Favoris : sauvegard√©s automatiquement dans votre navigateur (localStorage).<br>
         - Lecture : utilisez les boutons ‚Üê / ‚Üí ou glissez sur mobile pour changer de page.</p>
      <div style="margin-top:12px;text-align:right"><button onclick="closePanel('helpModal')" class="small-btn">Fermer</button></div>
    </div>
  </div>

  <div class="panel-modal" id="contactModal">
    <div class="panel">
      <h3>Contact</h3>
      <p>Pour suggestions, questions ou partenariat :<br>
      üìß contact@bdverse.com<br>Telegram : @BDVerseSupport</p>
      <div style="margin-top:12px;text-align:right"><button onclick="closePanel('contactModal')" class="small-btn">Fermer</button></div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-left">¬© 2025 BDVerse</div>
    <div class="footer-links">
      <a onclick="openPanel('aboutModal')">√Ä propos</a>
      <a onclick="openPanel('helpModal')">Aide</a>
      <a onclick="openPanel('contactModal')">Contact</a>
    </div>
  </footer>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav" aria-hidden="true">
    <div class="nav-item active" data-target="new" onclick="filterFromBottom(event)">üÜï<span style="font-size:11px">Nouveaut√©s</span></div>
    <div class="nav-item" data-target="popular" onclick="filterFromBottom(event)">üî•<span style="font-size:11px">Populaires</span></div>
    <div class="nav-item" data-target="recommended" onclick="filterFromBottom(event)">üí´<span style="font-size:11px">Recommand√©s</span></div>
    <div class="nav-item" data-target="favs" onclick="filterFromBottom(event)">‚ù§Ô∏è<span style="font-size:11px">Favoris</span></div>
  </div>

  <script>
    /* ---------- DONN√âES (exemples) ---------- */
    const comicsData = [
      {
        id: 1,
        title: "Tintin au Tibet",
        author: "Herg√©",
        category: "Aventure",
        rating: 4.8,
        readers: "125K",
        isNew: true,
        isPopular: true,
        isRecommended: true,
        coverImage: "https://images.unsplash.com/photo-1629992101753-56d196c8aace?w=600&h=900&fit=crop",
        synopsis: "Tintin part √† la recherche de son ami Tchang dans l'Himalaya. Une aventure pleine d'√©motion et de suspense.",
        chapters: [
          { number: 1, title: "La Disparition", pages: [
              "https://images.unsplash.com/photo-1588653818227-858700008e4f?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1589994965851-a8f479c573a9?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1589829545856-d10d557cf95f?w=800&h=1200&fit=crop"
          ]},
          { number: 2, title: "L'Exp√©dition", pages: [
              "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&h=1200&fit=crop"
          ]}
        ]
      },
      {
        id: 2,
        title: "Ast√©rix chez les Bretons",
        author: "Goscinny & Uderzo",
        category: "Humour",
        rating: 4.6,
        readers: "98K",
        isPopular: true,
        isRecommended: true,
        coverImage: "https://images.unsplash.com/photo-1532012197267-da84d127e765?w=600&h=900&fit=crop",
        synopsis: "Ast√©rix et Ob√©lix aident leurs cousins bretons contre l'envahisseur romain. Rires garantis !",
        chapters: [
          { number: 1, title: "L'Appel √† l'Aide", pages: [
              "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=800&h=1200&fit=crop"
          ]}
        ]
      },
      {
        id: 3,
        title: "Lucky Luke",
        author: "Morris",
        category: "Western",
        rating: 4.5,
        readers: "87K",
        isNew: true,
        coverImage: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=600&h=900&fit=crop",
        synopsis: "Le cow-boy le plus rapide de l'Ouest contre les fr√®res Dalton. Action et humour au programme.",
        chapters: [
          { number: 1, title: "L'√âvasion", pages: [
              "https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1476275466078-4007374efbbe?w=800&h=1200&fit=crop"
          ]}
        ]
      },
      {
        id: 4,
        title: "Gaston Lagaffe",
        author: "Franquin",
        category: "Humour",
        rating: 4.7,
        readers: "112K",
        isRecommended: true,
        coverImage: "https://images.unsplash.com/photo-1558901357-ca41e027e43a?w=600&h=900&fit=crop",
        synopsis: "Les gaffes et inventions du plus c√©l√®bre employ√© de bureau. √Ä mourir de rire !",
        chapters: [
          { number: 1, title: "La Nouvelle Invention", pages: [
              "https://images.unsplash.com/photo-1589994965851-a8f479c573a9?w=800&h=1200&fit=crop",
              "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=800&h=1200&fit=crop"
          ]}
        ]
      }
    ];

    /* ---------- √âTAT ---------- */
    let favorites = JSON.parse(localStorage.getItem('bd_favs')) || [];
    let comments = JSON.parse(localStorage.getItem('bd_comments')) || {
      1:[{author:"Marie D.",date:"2024-01-15",text:"Une aventure incroyable !"}],
      2:[{author:"Pierre L.",date:"2024-01-12",text:"Tr√®s dr√¥le !"}]
    };
    let currentUser = JSON.parse(localStorage.getItem('bd_user')) || null;

    let currentComic = null;
    let currentChapter = null;
    let currentPageIndex = 0;
    let currentZoom = 1;

    /* ---------- INIT ---------- */
    document.addEventListener('DOMContentLoaded', () => {
      renderAll();
      setupSearch();
      updateLoginBtn();
      setupBottomNav();
      updateFavIcons();
    });

    /* ---------- RENDERING ---------- */
    function renderAll(){
      renderSection('newComics', comicsData.filter(c => c.isNew));
      renderSection('popularComics', comicsData.filter(c => c.isPopular));
      renderSection('recommendedComics', comicsData.filter(c => c.isRecommended));
      renderFavoritesSection();
    }

    function renderSection(containerId, list){
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      list.forEach(item => {
        const node = createCard(item);
        container.appendChild(node);
      });
    }

    function renderFavoritesSection(){
      const container = document.getElementById('favoriteComics');
      container.innerHTML = '';
      const favs = comicsData.filter(c => favorites.includes(c.id));
      if(favs.length === 0){
        container.innerHTML = `<div style="color:var(--muted);padding:12px">Aucun favori ‚Äî ajoute-en depuis la fiche BD</div>`;
        return;
      }
      favs.forEach(item => container.appendChild(createCard(item)));
    }

    function createCard(item){
      const card = document.createElement('div');
      card.className = 'card';
      card.onclick = (e)=>{
        if(e.target.closest('.favorite')) return;
        openModal(item.id);
      };
      card.innerHTML = `
        ${item.isNew?'<div class="badge-new">NOUVEAU</div>':''}
        <div style="position:relative">
          <div class="favorite ${favorites.includes(item.id)?'active':''}" data-id="${item.id}" title="Ajouter aux favoris">‚ô•</div>
          <div class="cover"><img src="${item.coverImage}" alt="${escapeHtml(item.title)}" onerror="this.style.display='none'"></div>
        </div>
        <div class="meta">
          <div class="title">${escapeHtml(item.title)}</div>
          <div class="sub"><div style="color:var(--muted)">${escapeHtml(item.author)}</div><div style="color:var(--muted)">${item.readers}</div></div>
        </div>
      `;
      const favEl = card.querySelector('.favorite');
      favEl?.addEventListener('click', (ev)=>{
        ev.stopPropagation();
        toggleFavorite(item.id);
        favEl.classList.toggle('active');
        renderFavoritesSection();
      });
      return card;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
    }

    /* ---------- MODAL DETAILS ---------- */
    const modal = document.getElementById('modal');
    function openModal(id){
      currentComic = comicsData.find(c=>c.id===id);
      if(!currentComic) return;
      document.getElementById('modalCover').src = currentComic.coverImage;
      document.getElementById('modalTitle').textContent = currentComic.title;
      document.getElementById('modalMeta').textContent = `${currentComic.author} ‚Ä¢ ${currentComic.category} ‚Ä¢ ‚≠ê ${currentComic.rating}`;
      document.getElementById('modalSynopsis').textContent = currentComic.synopsis;

      // chapters
      const chList = document.getElementById('modalChapters'); chList.innerHTML = '';
      currentComic.chapters.forEach(ch=>{
        const div = document.createElement('div');
        div.className='chapter';
        div.onclick = ()=>startReading(currentComic.id, ch.number);
        div.innerHTML = `<div><strong>Chap ${ch.number}:</strong> ${escapeHtml(ch.title)}</div><div style="color:var(--muted)">${ch.pages.length} pages</div>`;
        chList.appendChild(div);
      });

      // similaires (same category)
      const simList = document.getElementById('similairesList'); simList.innerHTML = '';
      const similar = comicsData.filter(c=>c.category===currentComic.category && c.id!==currentComic.id).slice(0,6);
      similar.forEach(s=>{
        const card = document.createElement('div');
        card.className='card';
        card.style.width='120px';card.style.flex='0 0 120px';
        card.onclick = ()=>openModal(s.id);
        card.innerHTML = `<div class="cover"><img src="${s.coverImage}" onerror="this.style.display='none'"></div><div class="meta"><div class="title">${escapeHtml(s.title)}</div><div class="sub"><div style="color:var(--muted)">${escapeHtml(s.author)}</div></div></div>`;
        simList.appendChild(card);
      });

      // actions
      document.getElementById('addFavBtn').textContent = favorites.includes(currentComic.id)?'Retirer des favoris':'Ajouter aux favoris';
      document.getElementById('readNowBtn').onclick = ()=>startReading(currentComic.id, currentComic.chapters[0].number);
      document.getElementById('addFavBtn').onclick = ()=>{ toggleFavorite(currentComic.id); document.getElementById('addFavBtn').textContent = favorites.includes(currentComic.id)?'Retirer des favoris':'Ajouter aux favoris'; renderFavoritesSection(); };

      modal.classList.add('active');
    }
    function closeModal(){modal.classList.remove('active'); currentComic=null;}
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

    /* ---------- FAVORITES ---------- */
    function toggleFavorite(id){
      if(favorites.includes(id)){
        favorites = favorites.filter(x=>x!==id);
      }else favorites.push(id);
      localStorage.setItem('bd_favs', JSON.stringify(favorites));
      updateFavIcons();
    }
    function updateFavIcons(){
      document.querySelectorAll('.favorite').forEach(el=>{
        const id = Number(el.dataset.id);
        el.classList.toggle('active', favorites.includes(id));
      });
    }

    /* ---------- LECTEUR ---------- */
    const reader = document.getElementById('reader');
    const readerImg = document.getElementById('readerImg');
    const readerTitle = document.getElementById('readerTitle');
    const readerProgress = document.getElementById('readerProgress');

    function startReading(comicId, chapterNumber){
      const comic = comicsData.find(c=>c.id===comicId);
      if(!comic) return;
      const chapter = comic.chapters.find(ch=>ch.number===chapterNumber);
      if(!chapter) return;
      currentComic = comic;
      currentChapter = chapter;
      currentPageIndex = 0;
      currentZoom = 1;
      showReader();
      updateReaderImage();
      closeModal();
    }

    function showReader(){
      reader.classList.add('active');
      document.body.style.overflow='hidden';
    }
    function closeReader(){
      reader.classList.remove('active');
      document.body.style.removeProperty('overflow');
      currentComic = null; currentChapter = null; currentPageIndex = 0; currentZoom = 1;
    }

    function updateReaderImage(){
      if(!currentChapter) return;
      const url = currentChapter.pages[currentPageIndex];
      readerImg.src = url;
      readerTitle.textContent = `${currentComic.title} ‚Äî ${currentChapter.title}`;
      readerProgress.textContent = `${currentPageIndex + 1} / ${currentChapter.pages.length}`;
      document.getElementById('prevBtn').disabled = currentPageIndex === 0;
      document.getElementById('nextBtn').disabled = currentPageIndex === currentChapter.pages.length - 1;
      readerImg.style.transform = `scale(${currentZoom})`;
    }
    function prevPage(){ if(currentPageIndex>0){ currentPageIndex--; updateReaderImage(); } }
    function nextPage(){ if(currentPageIndex < currentChapter.pages.length -1){ currentPageIndex++; updateReaderImage(); } }

    function zoom(delta){
      currentZoom = Math.max(0.5, Math.min(2.5, currentZoom + delta));
      readerImg.style.transform = `scale(${currentZoom})`;
    }
    function resetZoom(){ currentZoom = 1; readerImg.style.transform = `scale(1)`; }

    document.getElementById('reader').addEventListener('click', function(e){
      if(e.target === this) closeReader();
    });

    /* ---------- SEARCH ---------- */
    function setupSearch(){
      const input = document.getElementById('searchInput');
      let timeout;
      input.addEventListener('input', ()=>{
        clearTimeout(timeout);
        timeout = setTimeout(()=>{ performSearch(input.value.trim()) }, 250);
      });
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') performSearch(input.value.trim()) });
    }
    function performSearch(q){
      if(!q){ renderAll(); return; }
      q = q.toLowerCase();
      const filtered = comicsData.filter(c => c.title.toLowerCase().includes(q) || c.author.toLowerCase().includes(q) || c.category.toLowerCase().includes(q));
      renderSection('newComics', filtered);
      document.getElementById('popularComics').innerHTML='';
      document.getElementById('recommendedComics').innerHTML='';
      document.getElementById('favoriteComics').innerHTML='';
    }

    /* ---------- AUTH SIMPLIFIEE ---------- */
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.addEventListener('click', ()=>{
      if(currentUser){
        if(confirm('Se d√©connecter ?')) { currentUser = null; localStorage.removeItem('bd_user'); updateLoginBtn(); }
        return;
      }
      const name = prompt('Nom d\'utilisateur (sera affich√© pour les commentaires) :');
      if(name){
        currentUser = { name }; localStorage.setItem('bd_user', JSON.stringify(currentUser)); updateLoginBtn();
        alert('Connect√© en tant que ' + name);
      }
    });
    function updateLoginBtn(){ loginBtn.textContent = currentUser ? currentUser.name : 'Connexion' }

    /* ---------- COMMENTS ---------- */
    function addCommentToCurrent(text){
      if(!currentUser){ alert('Connecte-toi pour commenter'); return; }
      if(!currentComic){ alert('Ouvre d\'abord la fiche de la BD'); return; }
      comments[currentComic.id] = comments[currentComic.id] || [];
      comments[currentComic.id].push({ author: currentUser.name, date: new Date().toISOString().split('T')[0], text });
      localStorage.setItem('bd_comments', JSON.stringify(comments));
      alert('Commentaire ajout√©');
    }
    
    /* ---------- BOTTOM NAV ---------- */
    function setupBottomNav(){
      document.querySelectorAll('.bottom-nav .nav-item').forEach(item=>{
        item.addEventListener('click', (e)=>filterFromBottom(e));
      });
    }
    function filterFromBottom(e){
      document.querySelectorAll('.bottom-nav .nav-item').forEach(n=>n.classList.remove('active'));
      const el = e.currentTarget; el.classList.add('active');
      const target = el.dataset.target;
      if(target==='new') document.getElementById('section-new').scrollIntoView({behavior:'smooth'});
      if(target==='popular') document.getElementById('section-popular').scrollIntoView({behavior:'smooth'});
      if(target==='recommended') document.getElementById('section-reco').scrollIntoView({behavior:'smooth'});
      if(target==='favs') document.getElementById('section-favs').scrollIntoView({behavior:'smooth'});
    }

    /* ---------- FOOTER PANELS ---------- */
    function openPanel(id){ document.getElementById(id).classList.add('active'); }
    function closePanel(id){ document.getElementById(id).classList.remove('active'); }

    /* ---------- UTIL ---------- */
    function seeAll(type){
      const list = (type==='new') ? comicsData.filter(c=>c.isNew) :
                   (type==='popular') ? comicsData.filter(c=>c.isPopular) :
                   (type==='recommended') ? comicsData.filter(c=>c.isRecommended) :
                   (type==='favs') ? comicsData.filter(c=>favorites.includes(c.id)) : [];
      const names = list.map(x=>`${x.title} ‚Äî ${x.author}`).join('\n');
      alert(names || 'Aucun √©l√©ment');
    }

    /* ---------- KEYBOARD / GESTURES ---------- */
    document.addEventListener('keydown', (e)=>{
      if(!reader.classList.contains('active')) return;
      if(e.key==='ArrowRight') nextPage();
      if(e.key==='ArrowLeft') prevPage();
      if(e.key==='+') zoom(0.1);
      if(e.key==='-') zoom(-0.1);
      if(e.key==='Escape') closeReader();
    });

    (function(){
      let startX=0,startY=0;
      const body = document.getElementById('readerBody');
      if(!body) return;
      body.addEventListener('touchstart', (e)=>{ startX=e.touches[0].clientX; startY=e.touches[0].clientY; }, {passive:true});
      body.addEventListener('touchend', (e)=>{
        const dx = (e.changedTouches[0].clientX - startX);
        const dy = (e.changedTouches[0].clientY - startY);
        if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx)>40){
          if(dx<0) nextPage(); else prevPage();
        }
      }, {passive:true});
    })();
  </script>
</body>
</html>